<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Possible Issues &amp; Troubleshooting · SDPAFamily.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://ericphanson.github.io/SDPAFamily.jl/issues/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SDPAFamily.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../usage/">Usage</a></li><li><a class="tocitem" href="../examples/">Examples</a></li><li class="is-active"><a class="tocitem" href>Possible Issues &amp; Troubleshooting</a><ul class="internal"><li><a class="tocitem" href="#Underflows"><span>Underflows</span></a></li><li><a class="tocitem" href="#Presolve"><span>Presolve</span></a></li><li><a class="tocitem" href="#Choice-of-parameters"><span>Choice of parameters</span></a></li><li><a class="tocitem" href="#Summary-of-problematic-problems"><span>Summary of problematic problems</span></a></li><li><a class="tocitem" href="#Troubleshooting"><span>Troubleshooting</span></a></li></ul></li><li><a class="tocitem" href="../reference/">Developer reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Possible Issues &amp; Troubleshooting</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Possible Issues &amp; Troubleshooting</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ericphanson/SDPAFamily.jl/blob/master/docs/src/issues.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Possible-Issues-and-Troubleshooting"><a class="docs-heading-anchor" href="#Possible-Issues-and-Troubleshooting">Possible Issues and Troubleshooting</a><a id="Possible-Issues-and-Troubleshooting-1"></a><a class="docs-heading-anchor-permalink" href="#Possible-Issues-and-Troubleshooting" title="Permalink"></a></h1><p>We now demonstrate some current limitations of this package via <a href="https://github.com/JuliaOpt/Convex.jl"><code>Convex.jl#master</code></a>&#39;s <code>Problem Depot</code>. This is run with <code>TEST=true</code>, meaning the solution returned by the solver will be tested against the true solution.</p><h2 id="Underflows"><a class="docs-heading-anchor" href="#Underflows">Underflows</a><a id="Underflows-1"></a><a class="docs-heading-anchor-permalink" href="#Underflows" title="Permalink"></a></h2><p>This occurs when the precision used to represent the solution is not high enough compared to the internal precision used by the solver. This lack of precision can lead to catastrophic cancellation. In the following, SDPA-QD is used to solve the problem, and <code>Float64</code> numbers are used to represent the obtained solution, and the test fails.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; test_problem = Convex.ProblemDepot.PROBLEMS[&quot;affine&quot;][&quot;affine_Diagonal_atom&quot;];</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; TEST = true; atol = 1e-3; rtol = 0.0;</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; test_problem(Val(TEST), atol, rtol, Float64) do problem
           solve!(problem, SDPAFamily.Optimizer{Float64}(variant=:sdpa_qd, silent=true))
       end</code><code class="nohighlight hljs ansi" style="display:block;">┌ Warning: Problem status INFEASIBLE; solution may be inaccurate.
└ @ Convex ~/.julia/packages/Convex/tSTAW/src/solution.jl:342
Test Passed</code></pre><p>We try to automatically detect underflows and warn against them; in this case, the warning is issued. Sometimes this can be avoided by choosing a better set of parameters. See <a href="#Choice-of-parameters">Choice of parameters</a>.</p><h2 id="Presolve"><a class="docs-heading-anchor" href="#Presolve">Presolve</a><a id="Presolve-1"></a><a class="docs-heading-anchor-permalink" href="#Presolve" title="Permalink"></a></h2><p>The usefulness of our <code>presolve</code> routine is demonstrated in <a href="../usage/#Using-presolve">Using presolve</a>. However, our <code>presolve</code> subroutine simply uses naïve Gaussian elimination and has its limitations. At its core, the <code>reduce!</code> method takes in a sparse matrix where each row is a linearized constraint matrix and apply Gaussian elimination with pivoting to identify the linear independence. This process is not numerically stable, and we cannot guarantee that all linear dependent entries will be identified.</p><p>This is demonstrated in the following example. We explicitly construct a matrix with linearly dependent rows. However, due to its numerical instability, we can only identify a subset of them.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; M = sprand(100, 20000, 0.03);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; λ = rand();</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; M[1, :] = λ*M[3, :] + (1-λ)*M[7, :];</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; rows = Set(rowvals(SDPAFamily.reduce!(M)[:, 1:end-1]));</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; redundant = collect(setdiff!(Set(1:10), rows));</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @test length(redundant) &gt;= 1</code><code class="nohighlight hljs ansi" style="display:block;">Test Passed</code></pre><h2 id="Choice-of-parameters"><a class="docs-heading-anchor" href="#Choice-of-parameters">Choice of parameters</a><a id="Choice-of-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Choice-of-parameters" title="Permalink"></a></h2><p>Unfortunately, we have not been able to successfully solve every problem that we have tried with one choice of parameters. We have chosen default parameter settings that we hope will work with a wide variety of problems. See <a href="../usage/#Usage">Usage</a> for details on switching to two other sets of parameters provided by the solvers.</p><p>This is an example where a better choice of parameters can help.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; test_problem = Convex.ProblemDepot.PROBLEMS[&quot;lp&quot;][&quot;lp_dotsort_atom&quot;];</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; TEST = true; atol = 1e-3; rtol = 0.0;</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; test_problem(Val(TEST), atol, rtol, Float64) do problem
           solve!(problem, SDPAFamily.Optimizer{Float64}(variant=:sdpa_dd, silent=true))
       end</code><code class="nohighlight hljs ansi" style="display:block;">┌ Warning: Problem status ITERATION_LIMIT; solution may be inaccurate.
└ @ Convex ~/.julia/packages/Convex/tSTAW/src/solution.jl:342
Test Failed at /home/runner/.julia/packages/Convex/tSTAW/src/problem_depot/problems/lp.jl:307
  Expression: ≈(p.optval, 19, atol = atol, rtol = rtol)
   Evaluated: -9009.485296833393 ≈ 19 (atol=0.001, rtol=0.0)
ERROR: There was an error during testing</code></pre><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; test_problem = Convex.ProblemDepot.PROBLEMS[&quot;lp&quot;][&quot;lp_dotsort_atom&quot;];</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; TEST = true; atol = 1e-3; rtol = 0.0;</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; test_problem(Val(TEST), atol, rtol, Float64) do problem
           solve!(problem, SDPAFamily.Optimizer{Float64}(variant=:sdpa_dd, silent=true, params = SDPAFamily.UNSTABLE_BUT_FAST))
       end</code><code class="nohighlight hljs ansi" style="display:block;">┌ Warning: Problem status ITERATION_LIMIT; solution may be inaccurate.
└ @ Convex ~/.julia/packages/Convex/tSTAW/src/solution.jl:342
Test Failed at /home/runner/.julia/packages/Convex/tSTAW/src/problem_depot/problems/lp.jl:307
  Expression: ≈(p.optval, 19, atol = atol, rtol = rtol)
   Evaluated: 9.631100304229781 ≈ 19 (atol=0.001, rtol=0.0)
ERROR: There was an error during testing</code></pre><h2 id="Summary-of-problematic-problems"><a class="docs-heading-anchor" href="#Summary-of-problematic-problems">Summary of problematic problems</a><a id="Summary-of-problematic-problems-1"></a><a class="docs-heading-anchor-permalink" href="#Summary-of-problematic-problems" title="Permalink"></a></h2><p>Due to the above reasons, we have modified the default settings for the following tests from <code>Convex.jl</code>&#39;s `Problem Depot&#39;.</p><table><tr><th style="text-align: left">Solver</th><th style="text-align: left">Underflow</th><th style="text-align: left">Need to use <code>params = SDPAFamily.UNSTABLE_BUT_FAST</code></th><th style="text-align: left">Presolve disabled due to long runtime</th></tr><tr><td style="text-align: left"><code>:sdpa_dd</code></td><td style="text-align: left"><code>affine_Partial_transpose</code></td><td style="text-align: left"><code>affine_Partial_transpose</code> <code>lp_pos_atom</code> <code>lp_neg_atom</code> <code>sdp_matrix_frac_atom</code> <code>lp_dotsort_atom</code></td><td style="text-align: left"><code>affine_Partial_transpose</code> <code>lp_min_atom</code> <code>lp_max_atom</code></td></tr><tr><td style="text-align: left"><code>:sdpa_qd</code></td><td style="text-align: left"><code>affine_Partial_transpose</code> <code>affine_Diagonal_atom</code></td><td style="text-align: left"><code>affine_Partial_transpose</code> <code>affine_Diagonal_atom</code></td><td style="text-align: left"><code>affine_Partial_transpose</code> <code>lp_min_atom</code> <code>lp_max_atom</code></td></tr><tr><td style="text-align: left"><code>:sdpa_gmp</code></td><td style="text-align: left"><code>affine_Partial_transpose</code></td><td style="text-align: left"><code>affine_Partial_transpose</code></td><td style="text-align: left"><code>affine_Partial_transpose</code> <code>lp_min_atom</code> <code>lp_max_atom</code></td></tr></table><p>In addition, we have excluded <code>lp_dotsort_atom</code> and <code>lp_pos_atom</code> when testing <code>:sdpa</code> due to imprecise solutions using default parameters. We have also excluded all second-order cone problems when using <code>BigFloat</code> or <code>Double64</code> numeric types, due to <a href="https://github.com/JuliaOpt/MathOptInterface.jl/issues/876">MathOptInterface.jl#876</a>, as well as the <code>sdp_lambda_max_atom</code> problem due to <a href="https://github.com/JuliaLinearAlgebra/GenericLinearAlgebra.jl/issues/47">GenericLinearAlgebra#47</a>. Both these issues have been fixed on the master branches of the respective packages, so these exclusions will be removed once new versions are released.</p><h2 id="Troubleshooting"><a class="docs-heading-anchor" href="#Troubleshooting">Troubleshooting</a><a id="Troubleshooting-1"></a><a class="docs-heading-anchor-permalink" href="#Troubleshooting" title="Permalink"></a></h2><p>When the solvers fail to return a solution, we recommend trying out the following troubleshoot steps.</p><ol><li>Set <code>silent=false</code> and look for warnings and error messages. If necessary, check the output file. Its path is printed by the solver output and can also be retrieved via <code>Optimizer.tempdir</code>.</li><li>Set <code>presolve=true</code> to remove redundant constraints. Typically, redundant constraints are indicated by a premature <code>cholesky miss</code> error as shown above.</li><li>Use <code>BigFloat</code> (the default) or <code>Double64</code> (from the <a href="https://github.com/JuliaMath/DoubleFloats.jl">DoubleFloats</a> package) precision instead of <code>Float64</code> (e.g. <code>SDPAFamily.Optimizer{Double64}(...)</code>). This will reduce the chance of having underflow errors when reading back the results.</li><li>Change the parameters by passing choices of parameters, e.g.  <code>SDPAFamily.Optimizer(params=(SDPAFamily.UNSTABLE_BUT_FAST))</code>, or <code>SDPAFamily.Optimizer(params=(epsilonDash=1e-40,))</code>. It might be helpful to use a tighter choice of the <code>epsilonDash</code> and <code>epsilonStar</code> parameters. See <a href="../usage/#Usage">Usage</a> and <a href="../usage/#Changing-parameters-and-solving-at-very-high-precision">Changing parameters &amp; solving at very high precision</a> for more options and examples.</li></ol></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../examples/">« Examples</a><a class="docs-footer-nextpage" href="../reference/">Developer reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Tuesday 27 June 2023 18:54">Tuesday 27 June 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
